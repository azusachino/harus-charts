# Project Overview

This project, `harus-charts`, is a Kubernetes infrastructure repository that manages Kubernetes resources using a hybrid approach:

- **CDK8s (Cloud Development Kit for Kubernetes):** TypeScript-based definition of Kubernetes manifests located in `application/`.
- **Helm Charts:** Managed charts located in `helm/`.
- **Raw Manifests:** Static YAML files located in `kubernetes/manifests/`.

## Prerequisites

This project uses `mise` to manage tool versions. Ensure you have `mise` installed. This project uses a CLI ticket system for task management. Run `tk help` when you need to use it.

The required tools defined in `mise.toml` are:

- `node` (LTS)
- `bun` (latest)
- `kubectl` (latest)
- `helm` (latest)
- `cdk8s-cli` (latest)

## Development Workflow

The project uses a `Makefile` to standardize common tasks.

### Installation

To install necessary tools and dependencies:

```bash

make install

```



### Initialization

To initialize the project (install dependencies and import Kubernetes schemas):

```bash

make init

```



### Imports

To import or update Kubernetes API schemas and CRDs:

```bash

make import

```



### Building & Synthesizing



To compile the TypeScript code and synthesize Kubernetes manifests:



```bash



make build    # Compiles TypeScript



make watch    # Runs TypeScript compiler in watch mode



make synth    # Synthesizes manifests to application/dist/



```







### Testing

To run the application tests:

```bash

make test

```



### Upgrading

To upgrade application dependencies:

```bash

make upgrade

```



### Deployment

To apply the synthesized manifests to your current Kubernetes context:

```bash
make deploy
```

### Cleanup

To remove build artifacts and node_modules:

```bash
make clean
```

## Directory Structure

- **`application/`**: Contains the CDK8s TypeScript project.
  - `src/main.ts`: Entry point for the application.
  - `src/main.test.ts`: Tests for the charts.
  - `src/etcd.ts`, `src/nginx.ts`, `src/mysql.ts`, `src/kafka.ts`: Chart definitions.
  - `dist/`: Output directory for synthesized YAML manifests (generated by `make synth`).
- **`argocd/`**: ArgoCD Application and cluster configurations.
- **`helm/`**: Contains Helm charts (e.g., `postgres-ha`).
- **`kubernetes/manifests/`**: Contains raw Kubernetes YAML files (deployed via ArgoCD).
- **`mise.toml`**: Configuration for `mise` tool version management.
- **`Makefile`**: Automation scripts for build, test, and deploy cycles.

## Additional Notes

- **Task Management**: The project refers to a CLI ticket system `tk`. Run `tk help` for usage if available.
