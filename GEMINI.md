# Project Overview

This project, `harus-charts`, is a Kubernetes infrastructure repository that manages Kubernetes resources using a hybrid approach:

- **CDK8s (Cloud Development Kit for Kubernetes):** TypeScript-based definition of Kubernetes manifests located in `cdk8s/`.
- **Helm Charts:** Managed charts located in `helm/`.
- **Raw Manifests:** Static YAML files located in `k8s/`.

## Prerequisites

This project uses `mise` to manage tool versions. Ensure you have `mise` installed. This project uses a CLI ticket system for task management. Run `tk help` when you need to use it.

The required tools defined in `mise.toml` are:

- `node` (LTS)
- `bun` (latest)
- `kubectl` (latest)
- `helm` (latest)
- `cdk8s-cli` (latest)

## Development Workflow

The project uses a `Makefile` to standardize common tasks.

### Installation

To install necessary tools and dependencies:

```bash

make install

```



### Initialization

To initialize the project (install dependencies and import Kubernetes schemas):

```bash

make init

```



### Imports

To import or update Kubernetes API schemas and CRDs:

```bash

make import

```



### Building & Synthesizing



To compile the TypeScript code and synthesize Kubernetes manifests:



```bash



make build    # Compiles TypeScript



make watch    # Runs TypeScript compiler in watch mode



make synth    # Synthesizes manifests to cdk8s/dist/



```







### Testing

To run the cdk8s tests:

```bash

make test

```



### Upgrading

To upgrade cdk8s dependencies:

```bash

make upgrade

```



### Deployment

To apply the synthesized manifests to your current Kubernetes context:

```bash
make deploy
```

### Cleanup

To remove build artifacts and node_modules:

```bash
make clean
```

## Directory Structure

- **`cdk8s/`**: Contains the CDK8s TypeScript project.
  - `main.ts`: Entry point for the application.
  - `main.test.ts`: Tests for the cdk8s charts.
  - `dist/`: Output directory for synthesized YAML manifests (generated by `make synth`).
- **`helm/`**: Contains Helm charts (e.g., `postgres-ha`).
- **`k8s/`**: Contains raw Kubernetes YAML files (e.g., Nginx deployment/service).
- **`mise.toml`**: Configuration for `mise` tool version management.
- **`Makefile`**: Automation scripts for build, test, and deploy cycles.

## Additional Notes

- **Task Management**: The project refers to a CLI ticket system `tk`. Run `tk help` for usage if available.
